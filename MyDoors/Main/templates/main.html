<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Door Filter</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Filter Doors</h1>
    <div class="box" style="display: flex">
        <div>
        <img  class="Door" src="" alt="" height="200px">
    </div>
        <div>
            <form method="get" action="{% url 'main' %}">

                <label >Select Shape:</label>
                <div >
                    <input type="hidden" name = "shape" id ="shape" value="">
                    {% for shape in shapes %}
                    <button type="button" onclick="set_shape(this)" value="{{ shape.id }}">
                        {{ shape.name }}
                    </button>
                    {% endfor %}
                </div>



                <label for="molding">Select Molding:</label>
                <div id="select_molding" >
                    <input type="hidden" name = "molding" id ="molding" value="">



                    </button>

                </div>


                <label for="portal">Select Portal:</label>
                <select name="portal" id="portal">
                    <option value="">-- All Portals --</option>
                </select>

                <label for="color">Select Color:</label>
                <select name="color" id="color">
                    <option value="">-- All Colors --</option>
                    {% for color in colors %}
                        <option value="{{ color.name }}">{{ color.name }}</option>
                    {% endfor %}
                </select>

                <button type="submit">Submit</button>
            </form>
        </div>

    </div>






    <script>
        var moldingId = "";
        var shapeId="";
        var colorId ="";
        var portalId="";
        function geturl(){
            if(shapeId && moldingId && portalId && colorId){
                    $.ajax({
                        url: 'api/get_door/',
                        data: { shape_id: shapeId,molding_Id : moldingId, portal_Id :portalId , color_id : colorId },
                        success: function (data ) {
                            $.each(data, function (index, door) {
                                $('.Door').attr("src",door.name);
                            });

                        }
                    });
                }else if (shapeId && moldingId && portalId ){
                    $.ajax({
                        url: 'api/get_door/',
                        data: { shape_id: shapeId,molding_Id : moldingId, portal_Id :portalId},
                        success: function (data ) {
                            $.each(data, function (index, door) {
                                $('.Door').attr("src",door.name);
                            });

                        }
                    });
                }
                else if (shapeId && moldingId ){
                    $.ajax({
                        url: 'api/get_door/',
                        data: { shape_id: shapeId,molding_Id : moldingId},
                        success: function (data ) {
                            $.each(data, function (index, door) {
                                $('.Door').attr("src",door.name);
                            });

                        }
                    });
                }else if (shapeId  ){
                    $.ajax({
                        url: 'api/get_door/',
                        data: { shape_id: shapeId},
                        success: function (data ) {
                            $.each(data, function (index, door) {
                                $('.Door').attr("src",door.name);
                            });

                        }
                    });
                }
        }





       function set_molding(button) {
            moldingId = button.value;
            $('#molding').attr("value",moldingId);
            $('#portal').empty();

            if (moldingId) {
                $.ajax({
                    url: '/api/portals/',  // Replace with your API endpoint
                    data: { molding_id: moldingId },
                    success: function (data) {
                        $.each(data, function (index, portal) {
                            $('#portal').append('<option value="' + portal.id + '">' + portal.name + '</option>');
                        });
                    }
                });
            }
            geturl()
        }

        function set_shape(button) {
            shapeId = button.value;
            $('#shape').attr("value",shapeId);
            $('#select_molding').empty();
            $('#select_molding').append('<input type="hidden" name = "molding" id ="molding" value="">');
            $('#portal').empty();

            if (shapeId) {
                $.ajax({
                    url: '/api/moldings/',  // Replace with your API endpoint
                    data: { shape_id: shapeId },
                    success: function (data ) {
                        $.each(data, function (index, molding) {
                            $('#select_molding').append('<button type="button" onclick="set_molding(this)" value="' + molding.id + '">' + molding.name + '</button>');
                        });
                    }
                });
                geturl()

            }
        }

</script>

</body>
</html>
